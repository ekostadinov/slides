<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Design principles and patterns</title>

		<meta name="description" content="Presentation about Automation testing with JAVA">
		<meta name="author" content="Evgeni Kostadinov">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../css/reveal.css">
		<link rel="stylesheet" href="../css/theme/progress.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../css/print/pdf.css' : '../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Design patterns and principles</h1>
					<p>
						<img width="600" height="300" data-src="../images/12/12s1.jpg">
					</p>
				</section>

				<section style="text-align: left;">
					<h4 style="font-style:italic; text-decoration: underline;">TABLE OF CONTENTS</h4>
					<ul>
						<li>Design concepts</li>
						<li>PageObject model</li>
						<li>PageFactory</li>
						<li>LoadableComponent</li>							
						<li>Object map</li>
						<li>xUnit design patterns</li>
					</ul>					
					<img style="margin-top:-90%;margin-left:10%;" width="300" height="400" data-src="../images/12/12s2.jpg">						
				</section>
				
				<section>
					<section>
						<h2>Design concepts</h2>
						<img width="400" height="400" src="../images/12/12s3.jpg">
					</section>
					<section>
						<h2>Design concepts</h2>					
						<ul> There is more than just SOLID
							<li><b>Separation of concerns</b> - divide your application into distinct features with as little overlap in functionality as possible.</li>							
							<li><b>Common Closure Principle (CCP)</b> - classes those changes together belong together.</li>
							<li><b>Acyclic Dependencies Principle (ADP)</b> - dependencies between packages must not form cycles.</li>							
							<li><b>Information Hiding</b> - a design decision should be hidden from the rest of the system to prevent unintended coupling.</li>
						</ul>
					</section>						
					<section>
						<h2>Design concepts(2)</h2>
						<ul>
							<li>Don't Repeat Yourself </li>
							<li>You Ain't Gonna Need It    </li>
							<li>Keep It Simple, Stupid</li>
							<li>Golden Hammer </li>
							<li>Feature Creep </li>
							<li>Death March </li>
							<li>Duck Tape Coder  </li>
							<li>Copy Folder Versioning   </li>
						</ul>
					</section>		
					<section>
						<h2>Design concepts(3)</h2>
						<ul>
							<li>Iceberg Class </li>
							<li>Spaghetti Code</li>
							<li>Calendar Coder</li>
							<li>Reinventing The Wheel </li>
							<li>Copy Paste Programming</li>
							<li>Boy Scout Rule</li>
							<li>Design By Committee</li>
							<li>Keep design consistent within each layer </li>
						</ul>
					</section>	
				</section>

				<section>
					<section>
						<h2>PageObject model</h2>
						<img width="400" height="500" src="../images/12/12s4.jpg">
					</section>											
					<section>
						<h2>PageObject model (2)</h2>
						<p>
							When we write tests against a web page, we need to refer to elements within that web page in order to simulate user interactions (click link) and determine what's displayed. However, if we write tests that manipulate the HTML elements directly your tests will be brittle to changes in the UI. A page object wraps an HTML page, or fragment, with an application-specific API (look at page as grouping of web services), allowing us to manipulate page elements without digging around in the HTML.
						</p>						
					</section>	
					<section>	
						<h2>PageObject model (3)</h2>
						<ul> 
							Technique for structuring test code that
							<li>Promotes reuse and reduces duplication</li>
							<li>Makes tests readable</li>
							<li>Makes tests more robust (less brittle)</li>
							<li>Improves maintainability, particularly if the application is rapidly evolving</li>
						</ul>						
						<img style="border:0px solid #000; margin-left:-20%;" width="450" height="250" src="../images/12/12s5.jpg">
					</section>		
					<section>	
						<h2>PageObject model (4)</h2>
						<ul>
							<li>Consolidates the code for interacting with any given UI element</li>
							<li>Allows you to model the UI in your tests</li>
							<li>
								Exposes methods that reﬂect the things a user can see and do on that page
								<ul>
									<li>addItemToCart(), getPrice()</li>
									<li>getEntryTitle(), saveDraft(), publishEntry()</li>
								</ul>
							</li>
							<li> Hides the details of telling the browser how to do those things </li>
						</ul>	
					</section>
					<section>
						<h2>PageObject model (5)</h2>						
						<pre>Log in POM<code>
import org.openqa.selenium.WebDriver;
 
import org.openqa.selenium.WebElement;
 
import org.openqa.selenium.support.FindBy;
 
import org.openqa.selenium.support.How;
 
public class LogInPage {
 
	final WebDriver driver;
 
	@FindBy(how = How.ID, using = "log")
 
	public WebElement txtbx_UserName;
 
	@FindBy(how = How.ID, using = "pwd")
 
	public WebElement txtbx_Password;
 
	@FindBy(how = How.NAME, using = "submit")
 
	public WebElement btn_Login ;
 
	public LogIn_PG_POF(WebDriver driver)
 
	{
		this.driver = driver;
	}
 
// This method will take two arguments ( Username nd Password)
 
	public void LogIn_Action(String sUserName, String sPassword){
 
		txtbx_UserName.sendKeys(sUserName);
 
		txtbx_Password.sendKeys(sPassword);
 
		btn_Login.click();
 
	}
 
}
						</code></pre>
					</section>		
					<section>	
						<h2>PageObject model - Some considerations</h2>
						<ul>
							<li>Violates <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">SRP</a></li>
							<li>Introduces <b style="color:red;">unnneded</b> Hierarchical taxonomies (via inheritance)</li>
							<li>No reuse of Generic structure (due to selectors encapsulation) like <a href="https://en.bem.info/methodology/key-concepts/">BEM</a></li>
						</ul>	
						<img style="border:0px solid #000; margin-left:-20%;" width="350" height="150" src="../images/12/12s6.jpg">
					</section>					
				</section>
							
				<section>
					<section>
						<h2>PageFactory</h2>
						<img width="400" height="500" src="../images/12/12factory.png">
					</section>
					<section>	
						<h2>PageFactory (2)</h2>
						<ul> 
							<li>Inbuilt page object model concept for Selenium WebDriver and it is very optimized</li>
							<li>
								One of the key advantage of using Page Factory pattern is <a href="https://seleniumhq.github.io/selenium/docs/api/java/org/openqa/selenium/support/pagefactory/AjaxElementLocatorFactory.html">AjaxElementLocatorFactory Class</a>
								<ul>
									<li>It is working on lazy loading concept, i.e. a timeout for a WebElement will be assigned to the Object page class with the help of AjaxElementLocatorFactory .</li>
									<li>Here, when an operation is performed on an element the wait for its visibility starts from that moment only. If the element is not found in the given time interval, test case execution will throw 'NoSuchElementException' exception.</li>
								</ul>
							</li>
						</ul>						
					</section>						
					<section>
						<h2>PageFactory (3)</h2>						
						<pre>AjaxElementLocatorFactory <code>
@Override
protected void configure() {
  WebDriver driver;
  switch (SeleniumConf.DRIVER) {
  case chrome:
    driver = createChromeDriver();
    break;
  case firefox:
  default:
    driver = creatFirefoxDriver();
    break;
  }
  final EventFiringWebDriver wrap = new EventFiringWebDriver(driver);
  wrap.register(new CustomWebDriverEventListener());

  bind(WebDriver.class).toInstance(wrap);

  bind(ElementLocatorFactory.class).toInstance(
      new AjaxElementLocatorFactory(wrap, SeleniumConf.TIMEOUT));

  // Page Objects here!
  bind(LoginPageObject.class).in(Singleton.class);
  bind(RegisterPageObject.class).in(Singleton.class);
  bind(EntityHeaderPageObject.class).in(Singleton.class);
  bind(ChatPageObject.class).in(Singleton.class);
  bind(SitePageObject.class).in(Singleton.class);

  final ResourceBundle english = ResourceBundle.getBundle("TestConstants", Locale.ENGLISH);
  final ResourceBundle spanish = ResourceBundle.getBundle("TestConstants", new Locale("es"));
  Locale.setDefault(Locale.ENGLISH);
  switch (SeleniumConf.LANG) {
  case es:
    bind(ResourceBundle.class).toInstance(spanish);
    break;
  case en:
  default:
    bind(ResourceBundle.class).toInstance(english);
    break;
  }

}
						</code></pre>
					</section>
					<section>
						<h2>PageFactory (4)</h2>						
						<pre>PageFactory - Test case<code>
import java.util.concurrent.TimeUnit; 
import pageObjects.Home_PG_POF; 
import pageObjects.LogIn_PG_POF; 
import org.openqa.selenium.WebDriver; 
import org.openqa.selenium.firefox.FirefoxDriver; 
import org.openqa.selenium.support.PageFactory; 
import org.testng.annotations.Test; 
import org.testng.annotations.BeforeMethod; 
import org.testng.annotations.AfterMethod;
 
public class PageFactory_TestCase {
 
	static WebDriver driver;
 
	Home_PG_POF HomePage;
 
	LogIn_PG_POF LoginPage;
 
  @BeforeMethod
 
  public void beforeMethod() {
 
	  driver = new FirefoxDriver();
 
      driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
 
      driver.get("http://www.store.demoqa.com");
 
      HomePage = PageFactory.initElements(driver, Home_PG_POF.class);
 
      LoginPage = PageFactory.initElements(driver, LogIn_PG_POF.class);
 
  }
 
  @Test
 
  public void test() {
 
      HomePage.lnk_MyAccount.click();
 
      LoginPage.LogIn_Action("testuser_1", "Test@123");
 
      System.out.println(" Login Successfully, now it is the time to Log Off buddy.");
 
      HomePage.lnk_LogOut.click();
 
  }
 
  @AfterMethod
 
  public void afterMethod() {
 
	  driver.quit();
 
  }
 
}
						</code></pre>
					</section>
				</section>
				
				<section>
					<section>
						<h2>Loadable Component</h2>
						<img width="600" height="400" src="../images/12/12load.png">
					</section>
					<section>	
						<h2>Loadable Component (2)</h2>
						<ul> 
							<li>A base class that aims to make writing PageObjects less painful</li>
							<li>By providing a standard way of ensuring that pages are loaded and providing hooks to make debugging the failure of a page to load easier</li>
							<li>Can be used to help reduce the amount of boilerplate code in your tests, which in turn make maintaining your tests less tiresome</li>
							<li>There is currently an implementation in Java that ships as part of Selenium 2, but the approach used is simple enough to be implemented in any language</li>
						</ul>						 
					</section>		
					<section>
						<h2>Loadable Component (3)</h2>
						<p> 
							LoadableComponent is a base class in Selenium, which means that you can simply deﬁne your Page Objects as an extension of the LoadableComponent class</li>
						</p>
						<pre>Loadable component<code>
package com.example.webdriver;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;

import static junit.framework.Assert.assertTrue;

public class EditIssue extends LoadableComponent<EditIssue> {

  private final WebDriver driver;

  // By default the PageFactory will locate elements with the same name or id
  // as the field. Since the summary element has a name attribute of "summary"
  // we don't need any additional annotations.
  private WebElement summary;

  // Same with the submit element, which has the ID "submit"
  private WebElement submit;

  // But we'd prefer a different name in our code than "comment", so we use the
  // FindBy annotation to tell the PageFactory how to locate the element.
  @FindBy(name = "comment") private WebElement description;

  public EditIssue(WebDriver driver) {
    this.driver = driver;

    // This call sets the WebElement fields.
    PageFactory.initElements(driver, this);
  }

  @Override
  protected void load() {
    driver.get("https://github.com/SeleniumHQ/selenium/issues/new");
  }

  @Override
  protected void isLoaded() throws Error {
    String url = driver.getCurrentUrl();
    assertTrue("Not on the issue entry page: " + url, url.endsWith("/new"));
  }

  public void setSummary(String issueSummary) {
    clearAndType(summary, issueSummary);
  }

  public void enterDescription(String issueDescription) {
    clearAndType(description, issueDescription);
  }

  public IssueList submit() {
    submit.click();
    return new IssueList(driver);
  }

  private void clearAndType(WebElement field, String text) {
    field.clear();
    field.sendKeys(text);
  }
}
						</code></pre>
					</section>						
					<section>
						<h2>Loadable Component (4)</h2>
						<ul> 
							<li>The Loadable Component Pattern also allows you to model your page objects as a <a href="https://github.com/SeleniumHQ/selenium/wiki/LoadableComponent#advanced-usage-nested-components">tree of nested components</a></li>
							<li>Allows better way to manage navigations between pages</li>
							<li>Uses the “load” method that is used to navigate to the page and the “isLoaded” method which is used to determine if we are on the right page</li>
						</ul>
						<img style="border:0px solid #000; margin-left:-20%;" width="350" height="150" src="../images/12/12loader.gif">
					</section>	
					<section>
						<h2>Slow Loadable Component</h2>
						<img width="600" height="400" src="../images/12/12imgloader.gif">
					</section>
					<section>
						<h2>Slow Loadable Component (2)</h2>
						<ul> 
							<li>The SlowLoadableComponent is a sub class of LoadableComponent</li>
							<li>get() for SlowLoadableComponent will ensure that the component is currently loaded</li>
							<li>isError() method will check for well known error cases, which would mean that loading has ﬁnished, but an error condition was seen</li>
							<li>waitFor() method will wait to run the next time</li>
							<li>After a call to load(), the isLoaded() method will continue to fail until the component has fully loaded</li>							
						</ul>
					</section>	
					<section>
						<h2>Slow Loadable Component (3)</h2>
						<pre>Slow Loadable Component<code>
public class ExpectedPage extends SlowLoadableComponent<ExpectedPage> {
	private WebDriver driver;

	public DefendantPage(WebDriver drv) {
		super(new SystemClock(), timeOutInSeconds);
		System.out.println("Loading Defendant Page");
		this.driver = drv;
		this.driver = new ReusableInternetExploderDriver();
		this.get();
		PageFactory.initElements(driver, this);
	} 

	@Override 
	protected void isLoaded() throws Error {
		WebElement myDynamicElement = ( new WebDriverWait(driver,	10) )
			.until(new ExpectedCondition<WebElement>(){	
				return d.findElement(By.className("prettyboxlabel"));
		}});

		if ( this.driver.getTitle().equalsIgnoreCase("Expected Text") )	{
			System.out.println("Expected page is loaded.");
			assertTrue(true);
		} else {
			System.out.println("Expected page is not loaded. 
			Actual page label is: " + pagelabel );
			assertTrue(false);
		}
	}

	@Override
	protected void load() { 
	System.out.println("Calling load...");
	// do whatever is necessary here to load the page
	// and then isLoaded() will be called again
	} 

	// the rest of the class is below , as necessary
}
						</code></pre>
					</section>						
				</section>
				
				<section>
					<section>
						<h2>Object map</h2>
						<img width="600" height="400" src="../images/12/12map.jpg">
					</section>
					<section>	
						<h2>Object map</h2>
						<ul> 
							<li>A very common way of minimizing the time it takes to update your automated test scripts is the use of a central <a href="http://www.ontestautomation.com/building-and-using-an-object-repository-in-selenium-webdriver/">object repository</a>(a.k.a Object map)</li>
							<li>can be implemented as a collection of key-value pairs, with the key being a logical name identifying the object and the value containing unique objects properties used to identify the object on a screen</li>							
						</ul>	
						<img width="400" height="200" src="../images/12/12s7.png">
					</section>
					<section>
						<h2>Object map (2)</h2>
						<ul> 
							<li>Our object map is a simple .properties text file that we add to our Selenium project</li>
							<li>The key for each object, for example bing.homepage.textbox, is a logical name for the object that we will use in our script.</li>
							<li>The corresponding value consists of two parts: the attribute type used for uniquely identifying the object on screen and the corresponding attribute value. </li>							
						</ul>
					</section>
					<section>
						<h2>Object map (3)</h2>
						<p>Retrieving objects from the object repository - we need to define an ObjectMap, with single argument constructor (path to the .properties file)</p>
						<pre>ObjectMap<code>
public class ObjectMap {
     
    Properties prop;
     
    public ObjectMap (String strPath) {
         
        prop = new Properties();
         
        try {
            FileInputStream fis = new FileInputStream(strPath);
            prop.load(fis);
            fis.close();
        }catch (IOException e) {
            System.out.println(e.getMessage());
        }
    }
}
							</code></pre>
						</section>
						<section>
						<h2>Object map (4)</h2>
						<ul> 
							<li>As you can see using an object from the object map in your test is as easy as referring to its logical name (i.e., the key in our object map)</li>
							<li>Object repository maintenance - 
with this straightforward mechanism we are able to vastly reduce the amount of time needed for script maintenance in case object properties change</li>	
					
							<li>All it takes is an update of the appropriate entries in the object map and we’re good to go and run our tests again</li>	
						</ul>
					</section>
				</section>
				
				<section>
					<section>
						<h2>xUnit patterns</h2>
						<img width="300" height="400" src="../images/12/12xu.jpg">
					</section>
					<section>	
						<h2>xUnit patterns (2)</h2>
						<ul> 
							<li><b>Back Door Manipulation:</b> We set up the test fixture or verify the outcome by going through a back door (such as direct database access).</li>
							<li><b>Database Sandbox:</b> We provide a separate test database for each developer or tester</li>						
							<li><b>Fresh Fixture:</b> Each test constructs its own brand-new test fixture for its own private use.</li>
							<li><b>Generated Value:</b> We generate a suitable value each time the test is run.</li>
						</ul>	
					</section>
					<section>	
						<h2>xUnit patterns (3)</h2>
						<ul> 
							<li><b>Four-Phase Test:</b> We structure each test with four distinct parts executed in sequence (Setup, Exercise, Verify, Teardown)</li>
							<li><b>Lazy Setup:</b>We use Lazy Initialization of the fixture to create it in the first test that needs it</li>
							<li><b>Minimal Fixture:</b>We use the smallest and simplest fixture possible for each test.</li>
							<li><b>Mock Object:</b>We replace an object the SUT depends on with a test-specific object that verifies it is being used correctly by the SUT.</li>				
						</ul>	
					</section>
					<section>	
						<h2>xUnit patterns (3)</h2>
						<ul> 
							<li><b>Shared Fixture:</b>We reuse the same instance of the test fixture across many tests</li>
							<li><b>In-line Setup: </b>Each Test Method creates its own Fresh Fixture by calling the appropriate constructor methods to build exactly the test fixture it requires.</li>		
							<li>And <a href="http://xunitpatterns.com/">many more</a></li>
						</ul>							 
						<img width="100" height="200" src="../images/12/12xninja.png">
					</section>
				</section>
				
				<section>
					<img width="900" height="500" data-src="../images/1qas.jpg">
					evgenikostadinov@gmail.com
				</section>		
				
				<section>
					<section>
						<h2>EXERCISE</h2>
						<img style="border:0px solid #000; margin-left:-20%;" width="900" height="550" src="../images/12/12e1.png">				
					</section>	
				</section>				
			</div>

		</div>

		<script src="../lib/js/head.min.js"></script>
		<script src="../js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../plugin/zoom-js/zoom.js', async: true },
					{ src: '../plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
